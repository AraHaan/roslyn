<#
.SYNOPSIS
    Gets the version number of the VS bootstrapper generated by the the MicroBuild
    BuildVSBootstrapper task and sets it to $env:BootstrapperVersion
#>

$FailureErrorCode = -1

if (($env:BUILD_STAGINGDIRECTORY -ne $null) -and ($env:BUILD_STAGINGDIRECTORY -ne [string]::Empty))
{
    $bootstrapperInfoPath = "$env:BUILD_STAGINGDIRECTORY\MicroBuild\Output\BootstrapperInfo.json"
}

if ([string]::IsNullOrWhiteSpace($bootstrapperInfoPath))
{
    if ($args.Count -eq 0)
    {
        exit $FailureErrorCode
    }

    $bootstrapperInfoPath = $args[0]
}

$jsonContent = Get-Content $bootstrapperInfoPath | ConvertFrom-Json

$version = $jsonContent.VSBuildVersion
Write-Host "$version"
$env:BootstrapperVersion = $version